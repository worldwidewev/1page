//©2014 髭散化汰. License at　http://www.apache.org/licenses/LICENSE-2.0
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,g){a!=Array.prototype&&a!=Object.prototype&&(a[e]=g.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var a=0;return function(e){return $jscomp.SYMBOL_PREFIX+(e||"")+a++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var e=0;return $jscomp.iteratorPrototype(function(){return e<a.length?{done:!1,value:a[e++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,e){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var g=0,k={next:function(){if(g<a.length){var h=g++;return{value:e(h,a[h]),done:!1}}k.next=function(){return{done:!0,value:void 0}};return k.next()}};k[Symbol.iterator]=function(){return k};return k};
$jscomp.polyfill=function(a,e,g,k){if(e){g=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var h=a[k];h in g||(g[h]={});g=g[h]}a=a[a.length-1];k=g[a];e=e(k);e!=k&&null!=e&&$jscomp.defineProperty(g,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");
(function(a,e){"object"===typeof exports&&"undefined"!==typeof module?e(exports):"function"===typeof define&&define.amd?define(["exports"],e):e(a.DDDINK={})})(this,function(a){function e(){}console.log("3Dink.js Version","2.1.0");if(THREE)var g=THREE;var k,h,f,p,q;e.prototype={isNewTab:"_blank",isShineOnMouse:"OFF",isShineOnTouch:"ON",shineColor:8947848,emissiveObject:void 0,setNewTab:function(c){this.isNewTab=c},setShineColor:function(c){this.emissiveObject=new g.Color(c)},setShineOnMouse:function(c){"OFF"!==
c&&"OFF"===l.isShineOnMouseCanvas&&(l.isShineOnMouseCanvas="ON");this.isShineOnMouse=c},setShineOnTouch:function(c){"OFF"!==c&&"ON"!==l.isShineOnTouchCanvas&&(l.isShineOnTouchCanvas="ON");this.isShineOnTouch=c}};var n={JudgeXYZ:function(c,b,d,m,a){d=void 0===d?"+-":d;m=void 0===m?"+-":m;a=void 0===a?"+-":a;this.obj=b?new THREE.Vector3(c.position.x+b.x,c.position.y+b.y,c.position.z+b.z):c;var e={};if("+-"===d||"+"===d)e.Xr=new THREE.Raycaster(this.obj.position,new THREE.Vector3(1,0,0));if("+-"===d||
"-"===d)e.Xl=new THREE.Raycaster(this.obj.position,new THREE.Vector3(-1,0,0));if("+-"===m||"+"===m)e.Ytop=new THREE.Raycaster(this.obj.position,new THREE.Vector3(0,1,0));if("+-"===m||"-"===m)e.Ybtm=new THREE.Raycaster(this.obj.position,new THREE.Vector3(0,-1,0));if("+-"===a||"+"===a)e.Zfw=new THREE.Raycaster(this.obj.position,new THREE.Vector3(0,0,1));if("+-"===a||"-"===a)e.Zbk=new THREE.Raycaster(this.obj.position,new THREE.Vector3(0,0,-1));this.judgeHit=c.userData.URL?function(b){for(var d in e)n.locateMy3Dink(b,
c.userData.URL,e[d],this.hitMargin[d])}:function(b){for(var c in e)n.locateOther3Dink(b,e[c],this.hitMargin[c])}},locateMy3Dink:function(c,b,d,a){d=d.intersectObjects(p.children,!0);0<d.length&&"PlaneGeometry"!==d[0].object.geometry.type&&d[0].distance<=a&&(location.href=b,cancelAnimationFrame(c))},locateOther3Dink:function(c,b,d){b=b.intersectObjects(p.children,!0);if(0<b.length){var a=b[0].object;if(b[0].distance<=d){if(!a.userData.linkConfig)if(a.parent.userData.linkConfig)a=a.parent;else return;
a.userData.URL&&(console.log(a.userData.URL),location.href=a.userData.URL,cancelAnimationFrame(c))}}}};n.JudgeXYZ.prototype.hitMargin={Xr:10,Xl:10,Ytop:10,Ybtm:10,Zfw:10,Zbk:10};n.JudgeXYZ.prototype.createHitMargin=function(c,b,d,a,e,f){this.hitMargin={Xr:void 0===c?10:c,Xl:void 0===b?10:b,Ytop:void 0===d?10:d,Ybtm:void 0===a?10:a,Zfw:void 0===e?10:e,Zbk:void 0===f?10:f}};var l={isShineOnMouseCanvas:"OFF",isShineOnTouchCanvas:void 0,cursorDefault:void 0,cursorOn3Dink:void 0,moveCount:0,itsModel:void 0,
selectedModel:{material:{emissive:void 0}},rect:void 0,touchLen:0,nonEmissiveObject:new g.Color(0),createEmissiveObject:function(){e.prototype.emissiveObject=new g.Color(e.prototype.shineColor)},getMousePoint:function(c){var b=new g.Vector2;b.x=c.clientX-this.rect.left;b.y=c.clientY-this.rect.top;b.x=b.x/k*2-1;b.y=2*-(b.y/h)+1;return b},getTouchPoint:function(c){var b=new g.Vector2;b.x=c.touches[0].clientX-this.rect.left;b.y=c.touches[0].clientY-this.rect.top;b.x=b.x/k*2-1;b.y=2*-(b.y/h)+1;return b},
getIntersectObj:function(c,b,d){var a=new g.Raycaster;a.setFromCamera(c,b);return a.intersectObjects(d.children,!0)},setParentObj:function(){this.itsModel.userData.linkConfig||(this.itsModel=this.itsModel.parent,this.itsModel.isParent=!0)},setShineModel:function(c){if(c.isParent)for(var b in c.children)c.children[b].material.emissive=c.userData.linkConfig.emissiveObject;else c.material.emissive=c.userData.linkConfig.emissiveObject},resetShineModel:function(c){if(this.selectedModel.isParent)for(var b in this.selectedModel.children)this.selectedModel.children[b].material.emissive=
this.nonEmissiveObject;else c.emissive=this.nonEmissiveObject},addAnchorMouse:function(c,b,d){null!==b&&d.removeChild(b);b=document.createElement("a");d.appendChild(b,null);b.id="Anchor3Dink";b.setAttribute("href",this.itsModel.userData.URL);b.style.display="inline-block";b.style.top=c.clientY-this.rect.top-.5+"px";b.style.left=c.clientX-this.rect.left-.5+"px";b.style.width="1px";b.style.height="1px";b.style.position="absolute";d.style.position="relative"},addAnchorTouch:function(c,b,d){null!==b&&
d.removeChild(b);b=document.createElement("a");d.appendChild(b,null);b.id="Anchor3Dink";b.setAttribute("href",this.itsModel.userData.URL);b.style.display="inline-block";b.style.top=c.touches[0].clientY-this.rect.top-.5+"px";b.style.left=c.touches[0].clientX-this.rect.left-.5+"px";b.style.width="1px";b.style.height="1px";b.style.position="absolute";d.style.position="relative"},shineModelFn:function(){var c=this.selectedModel.material,b=f.domElement.style;this.itsModel?(this.itsModel.userData.linkConfig||
this.itsModel.parent.userData.linkConfig?(this.setParentObj(),this.itsModel.userData.URL&&("OFF"===this.itsModel.userData.linkConfig.isShineOnMouse||!this.itsModel.material.emissive||this.itsModel.material.emissive.r||this.itsModel.material.emissive.g||this.itsModel.material.emissive.b||this.setShineModel(this.itsModel),b.cursor=this.cursorOn3Dink)):b.cursor=this.cursorDefault,this.selectedModel!==this.itsModel&&(c.emissive&&this.resetShineModel(c),this.selectedModel=this.itsModel)):b.cursor!==this.cursorDefault&&
(b.cursor=this.cursorDefault,c.emissive&&this.resetShineModel(c))},changeCursorFn:function(){var c=f.domElement.style;this.itsModel?this.itsModel.userData.linkConfig||this.itsModel.parent.userData.linkConfig?(this.setParentObj(),this.itsModel.userData.URL&&(c.cursor=this.cursorOn3Dink)):c.cursor=this.cursorDefault:c.cursor!==this.cursorDefault&&(c.cursor=this.cursorDefault)},shineModelFnTouch:function(){var c=this.selectedModel.material;if(this.itsModel){if(this.itsModel.userData.linkConfig||this.itsModel.parent.userData.linkConfig)this.setParentObj(),
this.itsModel.userData.URL&&("OFF"===this.itsModel.userData.linkConfig.isShineOnTouch||!this.itsModel.material.emissive||this.itsModel.material.emissive.r||this.itsModel.material.emissive.g||this.itsModel.material.emissive.b||this.setShineModel(this.itsModel));this.selectedModel!==this.itsModel&&(c.emissive&&this.resetShineModel(c),this.selectedModel=this.itsModel)}else c.emissive.r&&c.emissive.g&&c.emissive.b&&c.emissive&&this.resetShineModel(c)},shineModelA:function(c){var b=this.selectedModel.material,
d=f.domElement.style,a=document.getElementById("Anchor3Dink"),e=f.domElement.parentNode;this.itsModel?this.itsModel.userData.linkConfig||this.itsModel.parent.userData.linkConfig?(this.setParentObj(),this.itsModel.userData.URL?("OFF"===this.itsModel.userData.linkConfig.isShineOnMouse||!this.itsModel.material.emissive||this.itsModel.material.emissive.r||this.itsModel.material.emissive.g||this.itsModel.material.emissive.b||this.setShineModel(this.itsModel),d.cursor=this.cursorOn3Dink,this.addAnchorMouse(c,
a,e)):(d.cursor=this.cursorDefault,null!==a&&e.removeChild(a)),this.selectedModel!==this.itsModel&&(b.emissive&&this.resetShineModel(b),this.selectedModel=this.itsModel)):null!==a&&e.removeChild(a):d.cursor!==this.cursorDefault&&b.material.emissive?(d.cursor=this.cursorDefault,b.emissive&&this.resetShineModel(b)):null!==a&&e.removeChild(a)},changeCursorA:function(c){var b=f.domElement.style,d=document.getElementById("Anchor3Dink"),a=f.domElement.parentNode;if(this.itsModel){if(this.itsModel.userData.linkConfig||
this.itsModel.parent.userData.linkConfig)this.setParentObj(),this.itsModel.userData.URL?(b.cursor=this.cursorOn3Dink,this.addAnchorMouse(c,d,a)):(b.cursor=this.cursorDefault,null!==d&&a.removeChild(d))}else b.cursor!==this.cursorDefault&&(b.cursor=this.cursorDefault,null!==d&&a.removeChild(d))},shineModelATouch:function(c){var b=this.selectedModel.material,d=document.getElementById("Anchor3Dink"),a=f.domElement.parentNode;if(this.itsModel){if(this.itsModel.userData.linkConfig||this.itsModel.parent.userData.linkConfig)this.setParentObj(),
this.itsModel.userData.URL?("OFF"===this.itsModel.userData.linkConfig.isShineOnTouch||!this.itsModel.material.emissive||this.itsModel.material.emissive.r||this.itsModel.material.emissive.g||this.itsModel.material.emissive.b||this.setShineModel(this.itsModel),this.addAnchorTouch(c,d,a)):null!==d&&a.removeChild(d),this.selectedModel!==this.itsModel&&(b.emissive&&this.resetShineModel(b),this.selectedModel=this.itsModel)}else b.emissive.r&&b.emissive.g&&b.emissive.b&&(b.emissive&&this.resetShineModel(b),
null!==d&&a.removeChild(d))},addAnchorItsObjA:function(c){var b=document.getElementById("Anchor3Dink"),d=f.domElement.parentNode;if(this.itsModel){if(this.itsModel.userData.linkConfig||this.itsModel.parent.userData.linkConfig)this.setParentObj(),this.itsModel.userData.URL?this.addAnchorTouch(c,b,d):null!==b&&d.removeChild(b)}else null!==b&&d.removeChild(b)},makeEventFnc:function(c,b){return function(d){this.rect=f.domElement.getBoundingClientRect();var a=c(d);a=this.getIntersectObj(a,q,p);this.itsModel=
a[0]?a[0].object:void 0;this.moveCount++;b(d)}},loadPageLink:function(c){if(2>this.moveCount&&this.itsModel){if(!this.itsModel.userData.linkConfig)if(this.itsModel.parent.userData.linkConfig)this.itsModel=this.itsModel.parent;else return;this.itsModel.userData.URL&&(0===c.button||1===this.touchLen?"_blank"===this.itsModel.userData.linkConfig.isNewTab?open(this.itsModel.userData.URL):location.href=this.itsModel.userData.URL:1===c.button?open(this.itsModel.userData.URL):2===c.button&&console.log(this.itsModel.userData.URL))}},
addFnc:function(c,b,a,e){c=void 0===c?"Fn":c;b=void 0===b?"Fn":b;a=void 0===a?"pointer":a;e=void 0===e?"auto":e;k||(k=f.domElement.style.width,k=k.substr(0,k.length-2));h||(h=f.domElement.style.height,h=h.substr(0,h.length-2));void 0===l.isShineOnTouchCanvas&&(l.isShineOnTouchCanvas="ON");this.cursorDefault=e;this.cursorOn3Dink=a;this.createEmissiveObject();"Fn"===c&&(a="OFF"===this.isShineOnMouseCanvas?this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorFn.bind(this)):this.makeEventFnc(this.getMousePoint.bind(this),
this.shineModelFn.bind(this)),f.domElement.addEventListener("mousemove",a.bind(this),!1),f.domElement.addEventListener("mousedown",function(){this.moveCount=0}.bind(this),!1),f.domElement.addEventListener("mouseup",this.loadPageLink.bind(this),!1),console.log("Mouse: <Fuction> Mode by 3Dink.js"));"Fn"===b&&(a="OFF"===this.isShineOnTouchCanvas?this.makeEventFnc(this.getTouchPoint.bind(this),function(){}):this.makeEventFnc(this.getTouchPoint.bind(this),this.shineModelFnTouch.bind(this)),f.domElement.addEventListener("touchstart",
a.bind(this),!1),f.domElement.addEventListener("touchmove",a.bind(this),!1),f.domElement.addEventListener("touchstart",function(a){this.moveCount=0;this.touchLen=a.touches.length}.bind(this),!1),f.domElement.addEventListener("touchend",this.loadPageLink.bind(this),!1),console.log("Touch: <Fuction> Mode by 3Dink.js"));"A"===c&&("OFF"===this.isShineOnMouseCanvas?(a=this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorFn.bind(this)),f.domElement.addEventListener("mousemove",a.bind(this),
!1),a=this.makeEventFnc(this.getMousePoint.bind(this),this.changeCursorA.bind(this))):(a=this.makeEventFnc(this.getMousePoint.bind(this),this.shineModelFn.bind(this)),f.domElement.addEventListener("mousemove",a.bind(this),!1),a=this.makeEventFnc(this.getMousePoint.bind(this),this.shineModelA.bind(this))),f.domElement.addEventListener("mousedown",a.bind(this),!1),console.log("Mouse: <Anchor Tag> Mode by 3Dink.js"));"A"===b&&("OFF"===this.isShineOnTouchCanvas?(a=this.makeEventFnc(this.getTouchPoint.bind(this),
this.addAnchorItsObjA.bind(this)),f.domElement.addEventListener("touchstart",a.bind(this),!1),f.domElement.addEventListener("touchmove",a.bind(this),!1),f.domElement.addEventListener("touchend",function(){},!1)):(a=this.makeEventFnc(this.getTouchPoint.bind(this),this.shineModelATouch.bind(this)),f.domElement.addEventListener("touchstart",a.bind(this),!1),f.domElement.addEventListener("touchmove",a.bind(this),!1),f.domElement.addEventListener("mouseup",function(){},!1)),console.log("Touch: <Anchor Tag> Mode by 3Dink.js"))},
setGlobalLinkConfig:function(a,b,d,f){b=void 0===b?"OFF":b;d=void 0===d?"ON":d;e.prototype.isNewTab=a;e.prototype.isShineOnMouse=b;e.prototype.isShineOnTouch=d;e.prototype.shineColor=void 0===f?8947848:f;"OFF"!==b&&(l.isShineOnMouseCanvas="ON");"OFF"===d&&void 0!==l.isShineOnTouchCanvas&&(l.isShineOnTouchCanvas="OFF")}};a.domEvent=l;a.hitEvent=n;a.setWrapperLib=function(a){g=a};a.setCanvasSize=function(a,b){k=a;h=b};a.readRendererObj=function(a,b,d){f=a;p=b;q=d};a.addURL=function(a,b,d){d=void 0===
d?!1:d;a.userData.linkConfig?console.error('already made "linkConfig" object in '+Object.keys({model:a})[0]):a.userData.linkConfig=new e;Object.defineProperty(a.userData,"URL",{value:b,enumerable:!0,writable:d})};a.createBox=function(a,b,d,e,f,k,h,l){a=new g.BoxGeometry(a,b,d);if(h){h=(new g.TextureLoader).load(h);h.minFilter=g.LinearFilter;var c=new g.MeshPhongMaterial({map:h})}else l&&(c=new g.MeshPhongMaterial({color:l}));h=new g.Mesh(a,c);h.position.set(e,f,k);return h}});
